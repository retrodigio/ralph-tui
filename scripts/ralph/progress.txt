# Ralph Progress Log
Started: Sun 11 Jan 10:55:32 GMT 2026
---

## Codebase Patterns
- Use `pnpm typecheck` before committing
- ESLint 9 uses flat config format (eslint.config.js)
- TypeScript strict mode is enabled - all code must be fully typed
- OpenTUI requires Zig and Bun for native terminal rendering
- Use `bun run ./src/cli.tsx` to run the TUI in development
- Directory structure: src/{commands,tui,plugins/{agents,trackers}}
- TUI components go in src/tui/components/
- Package is ESM (`"type": "module"` in package.json)
- ABOUTME comment pattern required at top of each source file
- Use ReactNode return type instead of JSX.Element for component return types
- OpenTUI uses bundler module resolution - use `moduleResolution: "bundler"` in tsconfig
- Tracker plugins go in src/plugins/trackers/ with types, registry, base class
- Agent plugins go in src/plugins/agents/ with types, registry, base class
- Plugin architecture uses factory pattern + singleton registry
- CLI subcommands handled in src/cli.tsx with handleSubcommand()
- Agent plugins support detect(), execute(), interrupt() for AI CLI lifecycle
- BaseAgentPlugin spawns child processes with streaming output callbacks
- Configuration stored in YAML at ~/.config/ralph-tui/config.yaml
- Session/lock files stored in .ralph-session/ relative to cwd
- Iteration output saved to .ralph-output/ directory
- Use yaml package for YAML parsing
- Event-driven architecture for engine-to-TUI communication
- Commands that use JSX must have .tsx extension (not .ts)
---

## 2026-01-11 11:20 - ralph-tui-45r.1
- What was implemented:
  - Initialized pnpm project with package.json
  - Installed TypeScript (5.9.3) with strict mode configuration
  - Installed OpenTUI dependencies (@opentui/core, @opentui/react 0.1.72)
  - Created directory structure: src/, src/commands/, src/tui/, src/plugins/agents/, src/plugins/trackers/
  - Set up ESLint 9 with TypeScript support (flat config)
  - Added build scripts: build, typecheck, lint
  - Updated .gitignore for Node.js project
- Files changed:
  - package.json (new)
  - tsconfig.json (new)
  - eslint.config.js (new)
  - pnpm-lock.yaml (new)
  - src/index.ts (new)
  - src/commands/index.ts (new)
  - src/tui/index.ts (new)
  - src/plugins/agents/index.ts (new)
  - src/plugins/trackers/index.ts (new)
  - .gitignore (updated)
- **Learnings:**
  - OpenTUI uses hybrid TypeScript/Zig architecture for performance
  - Zig requirement should be documented as system prerequisite
  - ESLint 9 flat config requires @eslint/js and direct plugin imports
---

## 2026-01-11 - ralph-tui-45r.11
- What was implemented:
  - Core TUI layout using OpenTUI React framework
  - Header component: Ralph status indicator, epic name, elapsed timer, tracker name
  - Footer component: Keyboard shortcuts, progress bar showing task completion
  - LeftPanel component: Scrollable task list with status indicators (done/active/pending/blocked)
  - RightPanel component: Task details view with metadata and iteration output
  - Main App component with responsive layout (column layout for narrow terminals)
  - Theme system with Tokyo Night-inspired color palette
  - Type definitions for task items and component props
  - CLI entry point with Bun runner
  - Keyboard navigation (up/down/j/k, q/Escape to quit, p to pause)
- Files changed:
  - tsconfig.json (updated: bundler resolution, JSX import source)
  - package.json (updated: Bun build scripts, dev script)
  - src/cli.tsx (new)
  - src/tui/index.ts (updated)
  - src/tui/theme.ts (new)
  - src/tui/types.ts (new)
  - src/tui/components/index.ts (new)
  - src/tui/components/App.tsx (new)
  - src/tui/components/Header.tsx (new)
  - src/tui/components/Footer.tsx (new)
  - src/tui/components/LeftPanel.tsx (new)
  - src/tui/components/RightPanel.tsx (new)
- **Learnings:**
  - OpenTUI is Bun-native; use `bun build` for bundling
  - NodeNext module resolution doesn't work with OpenTUI's extensionless type imports
  - Use ReactNode instead of JSX.Element for component return types with bundler resolution
  - useTerminalDimensions hook provides responsive layout support
  - OpenTUI box component uses Yoga flexbox layout engine
---

## 2026-01-11 - ralph-tui-45r.5
- What was implemented:
  - TrackerPlugin TypeScript interface with full CRUD operations
  - TrackerTask unified type for cross-tracker task representation
  - BaseTrackerPlugin abstract class with common functionality (filtering, dependency checking)
  - TrackerRegistry singleton for plugin discovery and lifecycle management
  - Plugin discovery from ~/.config/ralph-tui/plugins/trackers/ directory
  - Built-in plugin stubs: json (prd.json), beads, beads-bv
  - SetupQuestion interface for plugin configuration wizards
  - CLI command 'ralph-tui plugins trackers' to list available plugins
- Files changed:
  - src/plugins/trackers/types.ts (new) - Core type definitions
  - src/plugins/trackers/base.ts (new) - Abstract base class
  - src/plugins/trackers/registry.ts (new) - Plugin registry and discovery
  - src/plugins/trackers/index.ts (updated) - Module exports
  - src/plugins/trackers/builtin/index.ts (new) - Built-in plugin registration
  - src/plugins/trackers/builtin/json.ts (new) - JSON tracker stub
  - src/plugins/trackers/builtin/beads.ts (new) - Beads tracker stub
  - src/plugins/trackers/builtin/beads-bv.ts (new) - Beads+bv tracker stub
  - src/commands/plugins.ts (new) - Plugin listing command
  - src/commands/index.ts (updated) - Export commands
  - src/cli.tsx (updated) - Handle subcommands
- **Learnings:**
  - Factory pattern decouples plugin instantiation from registration
  - Dynamic imports (await import()) enable runtime plugin discovery
  - Singleton registry with lazy init avoids loading plugins at import time
  - TrackerTask provides unified abstraction across all tracker backends
---

## 2026-01-11 - ralph-tui-45r.4
- What was implemented:
  - AgentPlugin TypeScript interface: name, detect(), execute(prompt, files), interrupt()
  - AgentPluginMeta with streaming, interrupt, fileContext capability flags
  - BaseAgentPlugin abstract class for CLI-based agents with child process management
  - AgentRegistry singleton for plugin discovery and lifecycle management
  - Plugin discovery from ~/.config/ralph-tui/plugins/agents/ directory
  - Built-in plugin stubs: claude (Claude Code CLI), opencode (OpenCode CLI)
  - AgentPluginConfig type for YAML config: command path, default flags, timeout
  - AgentExecutionHandle for controlling running executions
  - CLI command 'ralph-tui plugins agents' to list available agent plugins
- Files changed:
  - src/plugins/agents/types.ts (new) - Core type definitions
  - src/plugins/agents/base.ts (new) - Abstract base class with process spawning
  - src/plugins/agents/registry.ts (new) - Plugin registry and discovery
  - src/plugins/agents/index.ts (updated) - Module exports
  - src/plugins/agents/builtin/index.ts (new) - Built-in plugin registration
  - src/plugins/agents/builtin/claude.ts (new) - Claude Code plugin stub
  - src/plugins/agents/builtin/opencode.ts (new) - OpenCode plugin stub
  - src/commands/plugins.ts (updated) - Agent plugin listing
  - src/commands/index.ts (updated) - Export new functions
  - src/cli.tsx (updated) - Handle 'plugins agents' subcommand
- **Learnings:**
  - Agent plugins are fundamentally different from tracker plugins - they execute work (spawn CLIs) vs manage state
  - The detect() method checks CLI availability (runs --version), returns path and version info
  - AgentExecutionHandle provides promise + interrupt() + isRunning() for controlling executions
  - Child process management with timeout and SIGTERM/SIGKILL escalation for clean shutdown
  - Streaming callbacks (onStdout, onStderr) enable real-time output in TUI
---

## 2026-01-11 - ralph-tui-45r.27
- What was implemented:
  - `ralph-tui run` command with comprehensive CLI argument parsing
  - Configuration system (src/config/) with YAML loading from ~/.config/ralph-tui/config.yaml
  - Session and lock management (src/session/) for preventing concurrent instances
  - Execution engine (src/engine/) with iteration loop: select task → build prompt → run agent → check result
  - RunApp TUI component that integrates with the execution engine via events
  - Support for --epic, --prd, --agent, --model, --tracker, --iterations, --resume, --force, --headless flags
  - <promise>COMPLETE</promise> detection in agent output to signal task completion
  - Iteration output saved to .ralph-output/ directory
- Files changed:
  - src/commands/run.tsx (new) - Run command implementation
  - src/commands/index.ts (updated) - Export run command
  - src/cli.tsx (updated) - Add run subcommand handling
  - src/config/types.ts (new) - Configuration type definitions
  - src/config/index.ts (new) - Config loading and validation
  - src/session/types.ts (new) - Session type definitions
  - src/session/index.ts (new) - Lock and session management
  - src/engine/types.ts (new) - Engine event and state types
  - src/engine/index.ts (new) - ExecutionEngine class with iteration loop
  - src/tui/components/RunApp.tsx (new) - TUI component for run mode
  - src/tui/components/index.ts (updated) - Export RunApp
  - package.json (updated) - Added yaml dependency
  - bun.lock (new) - Lockfile migrated from pnpm
- **Learnings:**
  - JSX files need .tsx extension for TypeScript to recognize JSX syntax
  - Event-driven architecture decouples engine logic from TUI rendering
  - Lock files with PID tracking enable stale lock detection
  - The yaml package provides YAML parsing for config files
  - Session persistence enables resume capability across process restarts
---

## 2026-01-11 - ralph-tui-45r.9
- What was implemented:
  - Full BeadsTrackerPlugin implementing TrackerPlugin interface
  - detect(): Check for .beads/ directory and bd binary availability
  - getTasks(): Execute bd list --json with parent/status/labels filters
  - getTask(): Execute bd show ID --json for single task detail with dependencies
  - completeTask(): Execute bd update ID --status=closed with reason
  - updateTaskStatus(): Update task status via bd update command
  - sync(): Bidirectional sync with bd sync command
  - isComplete(): Check if all epic children are closed
  - Setup questions: epicId (required), beadsDir, labels
  - Status mapping between bd (closed/open) and TrackerTask (completed/open)
  - BeadJson interface matching bd JSON output structure
- Files changed:
  - src/plugins/trackers/builtin/beads.ts (updated from stub to full implementation)
- **Learnings:**
  - CLI wrapper pattern is preferable to direct file parsing - lets bd handle format evolution
  - bd dependencies array includes both "blocks" (true deps) and "parent-child" relationships
  - Two-tier filtering: push simple filters (status, labels) to CLI, complex filters (ready) in memory
  - bd --json output is consistent between list and show commands
  - bd update uses --status flag not --close_reason for closing beads
---

## 2026-01-11 - ralph-tui-45r.22
- What was implemented:
  - Error handling strategies: retry, skip, abort (configurable via ErrorHandlingConfig)
  - ErrorHandlingStrategy and ErrorHandlingConfig types in engine/types.ts
  - CLI options --on-error and --max-retries in RuntimeOptions
  - DEFAULT_ERROR_HANDLING constant with sensible defaults (skip, 3 retries, 5s delay)
  - New engine events: iteration:retrying, iteration:skipped
  - Enhanced iteration:failed event with 'action' field indicating retry/skip/abort
  - isTaskReady(id) method added to TrackerPlugin interface
  - Retry logic with configurable maxRetries and retryDelayMs
  - Skip logic that tracks skipped tasks to avoid re-selection
  - Abort logic that stops engine immediately on failure
- Files changed:
  - src/engine/types.ts (updated) - Added ErrorHandlingStrategy, ErrorHandlingConfig, new event types
  - src/engine/index.ts (updated) - Added runIterationWithErrorHandling, getNextAvailableTask, retry/skip tracking
  - src/config/types.ts (updated) - Added onError, maxRetries to RuntimeOptions, errorHandling to RalphConfig
  - src/config/index.ts (updated) - Build errorHandling config with CLI overrides
  - src/plugins/trackers/types.ts (updated) - Added isTaskReady(id) method to interface
  - src/plugins/trackers/base.ts (updated) - Implemented isTaskReady(id), renamed helper to checkTaskReady
- **Learnings:**
  - Error handling strategies should be pluggable with sensible defaults (skip is safest for autonomous agents)
  - Retry logic needs state tracking (retryCountMap) to persist across recursive calls
  - Skipped tasks need a Set to prevent re-selection in the same session
  - When max retries exceeded, fallback to skip is more graceful than abort for autonomous loops
  - Event-driven design allows TUI to display all error handling states without tight coupling
---

## 2026-01-11 - ralph-tui-45r.8
- What was implemented:
  - Full JsonTrackerPlugin for prd.json file-based task tracking
  - PrdJson and PrdUserStory interfaces matching the prd.json format spec
  - File I/O with caching (1 second TTL) for read performance
  - getTasks(): Read user stories with passes field mapped to status
  - getNextTask(): Select highest priority open task with no unresolved dependencies
  - completeTask(): Update passes: true in file with optional reason/notes
  - updateTaskStatus(): Update passes field based on TrackerTaskStatus
  - isComplete(): Check all stories have passes: true
  - Setup questions: path to prd.json file, git branch name
  - Validation: file exists, valid JSON, has userStories array
  - Priority mapping: prd 1-based to TrackerTask 0-4 scale
  - Dependency support via dependsOn field for story-to-story deps
- Files changed:
  - src/plugins/trackers/builtin/json.ts (updated from stub to full implementation)
- **Learnings:**
  - File-based trackers are simpler than CLI wrappers but require careful caching
  - The passes boolean field maps directly to completed/open status (no in_progress)
  - Caching with TTL prevents excessive file reads during rapid getTasks() calls
  - JSON pretty-printing (2-space indent) maintains human readability of prd.json
  - The prd.json format is intentionally simpler than beads - no sync, no CLI deps
---

## 2026-01-11 - ralph-tui-45r.12
- What was implemented:
  - US-012: Task List View with full acceptance criteria
  - Updated status indicators to match spec: ✓ (done), ▶ (active), ○ (pending), ⊘ (blocked)
  - Task ID displayed in muted color alongside truncated task title
  - Added truncateText() helper for graceful text truncation with ellipsis
  - Footer updated to show "X/Y complete" format instead of just "X/Y"
  - Enter key handling in App and RunApp to drill into task details
  - Added onTaskDrillDown callback prop for parent components to handle navigation
- Files changed:
  - src/tui/theme.ts (updated) - Changed status indicators for active (▶) and blocked (⊘)
  - src/tui/types.ts (updated) - Added onTaskDrillDown callback to LeftPanelProps
  - src/tui/components/LeftPanel.tsx (updated) - Task ID display, truncation support, maxWidth prop
  - src/tui/components/Footer.tsx (updated) - "complete" suffix in task counter
  - src/tui/components/App.tsx (updated) - Enter key handling, onTaskDrillDown prop
  - src/tui/components/RunApp.tsx (updated) - Enter key handling, onTaskDrillDown prop
- **Learnings:**
  - OpenTUI keyboard events use 'return' not 'enter' for the Enter key (but we handle both for safety)
  - Task truncation needs to account for status indicator + ID + spaces when calculating available width
  - The callback pattern (onTaskDrillDown) keeps components decoupled - LeftPanel doesn't need to know what happens on drill-down
  - Having both 'return' and 'enter' cases handles different terminal emulator behaviors
---

## 2026-01-11 - ralph-tui-45r.14
- What was implemented:
  - US-014: Iteration History View with full acceptance criteria
  - IterationHistoryView component displaying all iterations with key events
  - Status indicators: ✓ (completed), ▶ (running), ○ (pending), ✗ (failed), ⊘ (interrupted), ⊖ (skipped)
  - Each row shows: iteration number ("Iteration 1 of 10"), task ID, duration, outcome
  - Integrated with RunApp via 'i' key toggle between Tasks and Iterations views
  - Keyboard navigation (up/down/j/k) through iterations list
  - Enter key drills into iteration details via onIterationDrillDown callback
  - Pending iterations shown as placeholders when not yet executed
- Files changed:
  - src/tui/components/IterationHistoryView.tsx (new) - Iteration history display component
  - src/tui/components/index.ts (updated) - Export IterationHistoryView
  - src/tui/types.ts (updated) - Added IterationHistoryPanelProps, IterationResult import
  - src/tui/components/RunApp.tsx (updated) - View mode toggle, iteration state, navigation
- **Learnings:**
  - Extended IterationStatus type with DisplayIterationStatus to handle 'pending' for UI purposes
  - Discriminated unions (type: 'result' | 'pending') enable type-safe rendering of mixed lists
  - Separate selectedIndex states (tasks vs iterations) prevent confusion when switching views
  - View mode toggle pattern keeps TUI responsive without needing separate screens
---

## 2026-01-11 - ralph-tui-45r.19
- What was implemented:
  - US-019: Session Persistence with full acceptance criteria
  - PersistedSessionState type for saving: iteration, task statuses, start time, pause state, tracker state
  - Session file saved to .ralph-tui-session.json in project root
  - Session state saved automatically after each iteration completes
  - `ralph-tui resume` command to continue from saved state
  - `ralph-tui status` command to check if resumable session exists
  - Prompt shown when existing session found on `ralph-tui run`
  - Session file cleaned up automatically on successful completion
- Files changed:
  - src/session/persistence.ts (new) - Session persistence types and functions
  - src/session/index.ts (updated) - Export persistence module
  - src/commands/status.ts (new) - Status command implementation
  - src/commands/resume.tsx (new) - Resume command implementation
  - src/commands/index.ts (updated) - Export new commands
  - src/cli.tsx (updated) - Handle resume and status subcommands
  - src/commands/run.tsx (updated) - Integrate session persistence
- **Learnings:**
  - Session persistence uses a separate file (.ralph-tui-session.json) from the lock system (.ralph-session/)
  - State updates use immutable patterns with spread operators for safe concurrent access
  - Event-driven iteration completion hooks allow persistence without tight coupling
  - Session cleanup on completion prevents stale data; interrupted sessions remain resumable
---

## 2026-01-11 - ralph-tui-45r.2
- What was implemented:
  - US-002: Configuration System with Zod validation
  - Zod schema (src/config/schema.ts) for runtime config validation with helpful error messages
  - Project-level config support (.ralph-tui.yaml) that overrides global (~/.config/ralph-tui/config.yaml)
  - Config file search walks up directory tree from cwd to find project config
  - Deep merge strategy: project overrides global for scalars, replaces arrays entirely
  - `ralph-tui config show` command to display merged configuration with source info
  - `ralph-tui config help` with example config and documentation
  - Shorthand fields: agent, tracker, agentOptions, trackerOptions, autoCommit
- Files changed:
  - src/config/schema.ts (new) - Zod schemas and validation functions
  - src/config/types.ts (updated) - Added new StoredConfig fields
  - src/config/index.ts (updated) - Multi-file loading, merge logic, validation integration
  - src/commands/config.ts (new) - Config show and help commands
  - src/commands/index.ts (updated) - Export config commands
  - src/cli.tsx (updated) - Handle config subcommand
- **Learnings:**
  - Zod provides type inference from schemas, making the schema the single source of truth
  - Layered config (global → project → CLI) is a common pattern for dev tools
  - Array replacement vs merge: replacing gives projects full control over plugin lists
  - File search upward from cwd is standard for project config (like .gitignore, .eslintrc)
---

## 2026-01-11 - ralph-tui-45r.3
- What was implemented:
  - US-003: Interactive Project Setup wizard
  - Detect when no .ralph-tui.yaml exists in current directory
  - Prompt for issue tracker selection from installed tracker plugins
  - Show tracker-specific follow-up questions via getSetupQuestions()
  - Auto-detect installed agent CLIs (checks binary availability)
  - Prompt for max iterations per run (default: 10)
  - Prompt for auto-commit on task completion (yes/no)
  - Save configuration to .ralph-tui.yaml with YAML serialization
  - Add --no-setup flag to skip interactive wizard
  - Styled terminal prompts with ANSI colors
- Files changed:
  - src/setup/types.ts (new) - Type definitions for wizard state, answers, plugin detection
  - src/setup/prompts.ts (new) - Terminal prompts: text, select, boolean, number, path
  - src/setup/wizard.ts (new) - Main wizard logic, plugin detection, config saving
  - src/setup/index.ts (new) - Module exports
  - src/commands/setup.ts (new) - Setup command handler with --force flag
  - src/commands/index.ts (updated) - Export setup command
  - src/commands/run.tsx (updated) - Integrate setup detection on run
  - src/cli.tsx (updated) - Add setup command and --no-setup documentation
- **Learnings:**
  - Node.js readline works well for cross-platform terminal input
  - Plugin registries provide getSetupQuestions() for tracker-specific config
  - The factory pattern + singleton registry decouple plugin creation from discovery
  - Ctrl+C handling requires catching readline close errors gracefully
  - TypeScript union types need explicit handling in switch exhaustiveness checks
---

## 2026-01-11 - ralph-tui-45r.10
- What was implemented:
  - Full BeadsBvTrackerPlugin extending BeadsTrackerPlugin for smart task selection
  - detect(): Check for .beads/ directory, bd binary, and bv binary availability
  - getNextTask(): Execute bv --robot-triage, filter for epic children, return highest scored task
  - Parse JSON output for recommendations with scores, reasons, and breakdown metrics
  - getTaskReasoning(): Expose bv's "why this task" reasoning to TUI
  - getAllTaskReasoning(): Get all cached task reasoning from last triage
  - getTasks(): Augment task list with bv scoring metadata (score, reasons, unblocks)
  - Graceful fallback to beads-only behavior when bv unavailable
  - Recipe support: --recipe actionable (no blockers) or high-impact (PageRank)
  - Automatic triage refresh after completeTask() and updateTaskStatus()
  - Score breakdown parsing: pagerank, betweenness, staleness, urgency, risk, etc.
  - getTriageStats(): Quick reference stats (open, actionable, blocked counts)
  - isBvAvailable(): Check if smart mode is active
- Files changed:
  - src/plugins/trackers/builtin/beads-bv.ts (updated from stub to full implementation)
- **Learnings:**
  - TypeScript private fields prevent subclass access - use protected or config object pattern
  - bv --robot-triage provides comprehensive scoring in one call vs --robot-next for just top pick
  - Caching triage output enables efficient getTaskReasoning() lookups without re-querying bv
  - Graceful fallback pattern: check bvAvailable flag, call super.getNextTask() on any failure
  - Async triage refresh with `void this.refreshTriage()` keeps CRUD operations fast
---

## 2026-01-11 - ralph-tui-45r.6
- What was implemented:
  - Full ClaudeAgentPlugin implementing AgentPlugin interface
  - detect(): Uses `which` to find claude binary, then runs --version to verify
  - buildArgs(): Constructs CLI args with --print, --output-format, --model, --dangerously-skip-permissions
  - File context support via --add-dir flag for directories containing specified files
  - Setup questions for printMode (text/json/stream), model (sonnet/opus/haiku), skipPermissions (boolean)
  - Configurable timeout inherited from BaseAgentPlugin (defaults to 0 = no timeout)
  - Validation for printMode and model config values
- Files changed:
  - src/plugins/agents/builtin/claude.ts (updated from stub to full implementation)
- **Learnings:**
  - Claude Code CLI uses --print for non-interactive mode (not -p shorthand in code, but --print)
  - The --dangerously-skip-permissions flag enables autonomous operation without user confirmation
  - Using `which` for binary detection is more reliable than just trying to execute --version
  - File context via --add-dir adds directories to Claude's working context, not individual files
  - The base class already handles SIGTERM/SIGKILL escalation for timeout - just set defaultTimeout
---

## 2026-01-11 - ralph-tui-45r.7
- What was implemented:
  - Full OpenCodeAgentPlugin implementing AgentPlugin interface
  - detect(): Uses `which` to find opencode binary, then runs --version to verify
  - buildArgs(): Constructs CLI args with `opencode run --agent <type>` for non-interactive mode
  - Model support via --model flag with provider/model format (e.g., anthropic/claude-3-5-sonnet)
  - File context support via --file flag (can be used multiple times)
  - Agent type selection via --agent flag (general, build, plan)
  - Output format selection via --format flag (default, json)
  - Setup questions for provider, model, agent type, and output format
  - Configurable timeout inherited from BaseAgentPlugin (defaults to 0 = no timeout)
  - Validation for provider, agent, and format config values
- Files changed:
  - src/plugins/agents/builtin/opencode.ts (updated from stub to full implementation)
- **Learnings:**
  - OpenCode uses `opencode run <prompt>` for non-interactive mode (not flags like --print)
  - Model format is provider/model (e.g., anthropic/claude-3-5-sonnet, openai/gpt-4o)
  - OpenCode supports multiple agent types: general (default), build, plan - switchable via --agent
  - The --file flag can be used multiple times to attach multiple files
  - Providers include: anthropic, openai, google, xai, ollama
---

## 2026-01-11 - ralph-tui-45r.13
- What was implemented:
  - US-013: Task Detail View with full acceptance criteria
  - TaskDetailView component with comprehensive task details display
  - Full task title, ID, status, and metadata section
  - Description in scrollable container (separated from acceptance criteria)
  - Acceptance criteria parser: extracts markdown checklists (- [ ]/- [x]) as interactive checklist
  - Priority display with color coding (P0-P4, mapped to error/warning/normal colors)
  - Labels/tags display with accent color styling
  - Dependencies section showing "Blocked by" and "Blocks" relationships
  - Completion notes section for closed tasks
  - Extended TaskItem type with additional fields (priority, labels, dependsOn, blocks, closeReason, etc.)
  - View mode toggle in App and RunApp (list <-> detail)
  - Esc key handling to return from detail view to list view
  - 't' key shortcut to return to task list from any view
  - Enter key on task list drills into detail view
- Files changed:
  - src/tui/components/TaskDetailView.tsx (new) - Full task detail display
  - src/tui/components/App.tsx (updated) - View mode toggle and keyboard handling
  - src/tui/components/RunApp.tsx (updated) - View mode toggle and keyboard handling
  - src/tui/components/index.ts (updated) - Export TaskDetailView
  - src/tui/types.ts (updated) - Extended TaskItem type, added TaskDetailViewProps
- **Learnings:**
  - OpenTUI's TextProps doesn't support 'bold' attribute - text styling is done via colors/fg only
  - The TaskPriority type should be imported from trackers/types.ts to avoid duplicate exports
  - Acceptance criteria parsing can be done by looking for markdown checklist patterns
  - View mode toggle pattern with detailTask state allows full-screen detail views
  - Separating q (quit) and Escape (back) provides better UX for drill-down navigation
---

## 2026-01-11 - ralph-tui-45r.15
- What was implemented:
  - US-015: Iteration Detail View with full acceptance criteria
  - IterationDetailView component with comprehensive iteration details display
  - Iteration header showing number, status indicator, and "X of Y" format
  - Task info section with ID and title
  - Metadata section: status, start time, end time, duration, task completion, promise detection
  - Events timeline with timestamped key events (started, agent running, task completed, etc.)
  - Color-coded event symbols matching the theme
  - Scrollable agent output with syntax highlighting for code blocks
  - Code blocks displayed in boxed containers with language labels
  - Persisted output file path display
  - Esc key navigation to return to iteration list
  - View mode toggle integrated with RunApp (tasks ↔ iterations ↔ detail views)
- Files changed:
  - src/tui/components/IterationDetailView.tsx (new) - Full iteration detail display
  - src/tui/components/RunApp.tsx (updated) - View mode toggle and keyboard handling
  - src/tui/components/index.ts (updated) - Export IterationDetailView
- **Learnings:**
  - Code block syntax highlighting can be done by detecting ``` markers and rendering in different styles
  - Timeline events are built from IterationResult data - start/agent/task completion/end events
  - The iteration-detail view follows the same pattern as task-detail: full-screen scrollbox with Esc to return
  - OpenTUI scrollbox handles large content well for potentially large agent outputs
---

## 2026-01-11 - ralph-tui-45r.16
- What was implemented:
  - US-016: Progress Dashboard with full acceptance criteria
  - ProgressDashboard component showing comprehensive execution status
  - Task progress bar: completed / total tasks with percentage
  - Iteration progress bar: current / max iterations with percentage
  - Elapsed time display using existing formatElapsedTime utility
  - ETA calculation based on average iteration duration
  - Status display: Running / Paused / Completed / Failed with color-coded indicators
  - Agent name and tracker name display
  - Toggle dashboard visibility with 'd' key
  - Added completedIterations state tracking for ETA calculation
  - Dashboard shows between Header and main content area
  - Auto-update every second (uses existing interval from RunApp)
- Files changed:
  - src/tui/components/ProgressDashboard.tsx (new) - Progress dashboard component
  - src/tui/components/RunApp.tsx (updated) - Integrated ProgressDashboard, added state
  - src/tui/components/index.ts (updated) - Export ProgressDashboard
  - src/tui/theme.ts (updated) - Added 'd' shortcut for dashboard toggle
- **Learnings:**
  - ETA calculation needs at least one completed iteration before providing an estimate
  - The dashboard toggle pattern keeps the TUI uncluttered while providing detail on demand
  - Tracking completedIterations separately from iterations array allows for accurate ETA math
  - Nested ProgressBar components keep the main component clean and reusable
---

## 2026-01-11 - ralph-tui-45r.17
- What was implemented:
  - US-017: Pause and Resume with full acceptance criteria
  - Added 'pausing' status to EngineStatus type to distinguish "pause requested" from "actually paused"
  - Engine runLoop now properly waits when paused instead of continuing immediately
  - Press 'p' to request pause - shows "Pausing after current iteration..." status
  - Engine transitions to 'paused' state after current iteration completes
  - Press 'p' again while pausing to cancel the pause request
  - Press 'p' while paused to resume execution
  - Paused state is persisted to .ralph-tui-session.json via pauseSession() function
  - Sessions with 'paused' status are resumable with `ralph-tui resume`
  - User can quit while paused and resume later with the resume command
  - Updated Header, ProgressDashboard, and RunApp components to display pausing/paused states
  - Added '◎' indicator for 'pausing' status, '⏸' for 'paused' status
- Files changed:
  - src/engine/types.ts (updated) - Added 'pausing' to EngineStatus type with documentation
  - src/engine/index.ts (updated) - Enhanced runLoop with pause check and wait loop, updated pause()/resume() methods, added isPaused()/isPausing() helpers
  - src/tui/theme.ts (updated) - Added 'pausing' to RalphStatus type, added pausing indicator
  - src/tui/components/Header.tsx (updated) - Added 'pausing' case to getStatusDisplay()
  - src/tui/components/ProgressDashboard.tsx (updated) - Added 'pausing' case with "Pausing after current iteration..." label
  - src/tui/components/RunApp.tsx (updated) - Enhanced keyboard handler for pause toggle, added pausing status mapping
  - src/commands/run.tsx (updated) - Added pause/resume event handlers for state persistence
  - src/commands/resume.tsx (updated) - Enhanced to handle paused state persistence and proper cleanup
- **Learnings:**
  - Two-stage pause (pausing → paused) provides better UX than immediate pause during long operations
  - The engine loop checks pause state at the top of each iteration, not in the middle
  - Pressing 'p' twice quickly cancels a pending pause - useful if user changes their mind
  - Session persistence uses isPaused flag and pausedAt timestamp for resumable state
  - Events (engine:paused, engine:resumed) drive both TUI updates and state persistence
---

## 2026-01-11 - ralph-tui-45r.18
- What was implemented:
  - US-018: Graceful Interruption with full acceptance criteria
  - New interruption module (src/interruption/) with types, handler, and index exports
  - InterruptHandler with double-press detection (1 second window)
  - ConfirmationDialog TUI component for interrupt confirmation overlay
  - RunApp integration: showInterruptDialog prop, onInterruptConfirm/Cancel callbacks
  - RunAppWrapper component manages dialog state and bridges to interrupt handler
  - Press Ctrl+C shows confirmation: "Interrupt Ralph? [y/N]"
  - Press y to confirm: stops agent, saves state, exits gracefully with code 0
  - Press n or Esc to cancel and continue execution
  - Press Ctrl+C twice quickly to force quit immediately (exit code 1)
  - In headless mode: first Ctrl+C triggers graceful shutdown with hint about double-press
  - Session state properly saved before exit (status: 'interrupted')
  - Agent process properly terminated via engine.dispose()
  - SIGTERM handled separately (always graceful, no confirmation)
- Files changed:
  - src/interruption/types.ts (new) - InterruptState, InterruptHandler, ConfirmationDialogProps types
  - src/interruption/handler.ts (new) - createInterruptHandler with signal handling
  - src/interruption/index.ts (new) - Module exports
  - src/tui/components/ConfirmationDialog.tsx (new) - Modal dialog component
  - src/tui/components/index.ts (updated) - Export ConfirmationDialog
  - src/tui/components/RunApp.tsx (updated) - Added interrupt dialog props and keyboard handling
  - src/commands/run.tsx (updated) - RunAppWrapper, interrupt handler integration, headless mode updates
- **Learnings:**
  - OpenTUI uses `border: true` with `borderColor` instead of CSS-style `borderStyle`
  - OpenTUI text elements use `fg` prop directly, not style objects with textAlign
  - Modal centering requires nested flex containers, no CSS transforms support
  - React state for dialogs requires wrapper component when logic is in non-React code
  - Signal handlers must be properly cleaned up via dispose() to prevent memory leaks
---

## 2026-01-11 - ralph-tui-45r.20
- What was implemented:
  - US-020: Iteration Output Persistence with full acceptance criteria
  - New logs module (src/logs/) with types, persistence, and index exports
  - Iteration logs now saved to .ralph-tui/iterations/ directory (new standard location)
  - Log format: iteration-{N}-{taskId}.log with structured header + raw output
  - Log header includes: timestamp, task details, duration, status, outcome, agent/model info
  - Raw output section contains full stdout/stderr separated by dividers
  - `ralph-tui logs` command to list all iteration logs with summary table
  - `ralph-tui logs --iteration 5` to view specific iteration in detail
  - `ralph-tui logs --task US-005` to view all iterations for a task
  - `ralph-tui logs --clean --keep 10` to clean up old logs
  - `--dry-run` flag for cleanup preview without deletion
  - `--verbose` flag for full output display (not truncated)
  - Engine now tracks stderr separately alongside stdout for persistence
  - EngineState extended with currentStderr field
- Files changed:
  - src/logs/types.ts (new) - Type definitions for iteration logs
  - src/logs/persistence.ts (new) - Save/load/list/clean functions
  - src/logs/index.ts (new) - Module exports
  - src/commands/logs.ts (new) - Logs command implementation
  - src/commands/index.ts (updated) - Export logs command
  - src/cli.tsx (updated) - Add logs subcommand handling
  - src/engine/types.ts (updated) - Added currentStderr to EngineState
  - src/engine/index.ts (updated) - Use new saveIterationLog, track stderr
- **Learnings:**
  - Structured log format with dividers allows machine-parseable headers while preserving raw output
  - Separating stdout/stderr in logs helps debugging agent issues vs task issues
  - The old .ralph-output/ directory used minimal markdown; new format is richer with full metadata
  - Log cleanup should sort by iteration number descending to keep most recent
  - Partial task ID matching in filter enables fuzzy search (e.g., "US-" matches all user stories)
---
